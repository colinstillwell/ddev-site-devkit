#!/usr/bin/env bash

#ddev-generated
## Command provided by https://github.com/colinstillwell/ddev-site-devkit
## Description: Run a script on the host or in the web container.
## Usage: devkit-run-script [script] [flags] [args]
## Example: "ddev devkit-run-script scripts/example.sh --web"
## Flags: [{"Name":"host","Usage":"Run the script on the host"},{"Name":"web","Usage":"Run the script in the web container"}]
## Aliases: devkit:run-script

# Exit on error; treat unset variables as errors; fail pipelines if any command fails
set -euo pipefail

# Defaults
MODE=host
SCRIPT_PATH=""
ARGS=()

# Parse flags
while [[ $# -gt 0 ]]; do
  case "$1" in
    --web)  MODE=web;  shift; continue ;;
    --host) MODE=host; shift; continue ;;
    --)     shift; ARGS+=("$@"); break ;;
  esac

  if [[ -z "$SCRIPT_PATH" ]]; then
    SCRIPT_PATH="$1"; shift
  else
    ARGS+=("$1"); shift
  fi
done

# Validate
if [[ -z "${SCRIPT_PATH-}" ]]; then
  echo "[script] is required."
  exit 2
fi

# Commands
if [[ "$MODE" == host ]]; then
  SCRIPT_PATH="$DDEV_APPROOT/$SCRIPT_PATH"
  exec bash "$SCRIPT_PATH" "${ARGS[@]}"
else
  exec ddev exec bash "$SCRIPT_PATH" "${ARGS[@]}"
fi
